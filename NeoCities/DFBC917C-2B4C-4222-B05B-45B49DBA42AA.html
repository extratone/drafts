<!DOCTYPE html>
<html dir="auto">

<head>
  <title>“A table view that allows navigation and selection using a hardware keyboard.”   Swift Snippet by Douglas Hill</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    @charset "utf-8";

    :root {
      --main-bg-color: #000056;
      --main-color: #ffe8bd;
      --alternate-bg-color: #1c0021;
      --alternate-color: #fff4e6;
      --main-border-color: #f43f32;
        --link-color: #36fd63;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --main-bg-color: #fff4e6;
        --main-color: #00006b;
        --alternate-bg-color: #fffdeb;
        --alternate-color: #1c0021;
        --main-border-color: #f43f32;
          --link-color: #ff0000;
      }
    }

    html {
      font-size: 100%;
      font-family: -apple-system, BlinkMacSystemFont, "helvetica neue", helvetica, roboto, noto, "segoe ui", arial, sans-serif;
      line-height: 1.4;
    }

    body {
      margin: 0;
      padding: 1em;
      background-color: var(--main-bg-color);
      color: var(--main-color);
    }

    @media (max-device-width: 480px) {}

    @media (min-device-width: 481px) {
      body {
        margin: auto;
        max-width: 600px;
      }
    }

    blockquote {
      font-style: italic;
      margin: 1.5em 2em;
      padding: 1em;
      background-color: var(--alternate-bg-color);
      color: var(--alternate-color);
    }

    a {
      color: var(--link-color);
    }
    pre {
      display: block;
      overflow: scroll;
      width: 100%;
      background-color: var(--alternate-bg-color);
      padding: .5em 1em;
      margin: 1em 0;
    }

    code {
      background-color: var(--alternate-bg-color);
      color: var(--alternate-color);
      font-family: Menlo, Courier, sans-serif;
      padding: 2px 3px;
    }

    table {
      margin: 1.5em 0;
      border: 1px solid var(--main-border-color);
      border-collapse: collapse;
    }

    th {
      padding: .25em .5em;
      background: var(--alternate-bg-color);
      border: 1px solid var(--main-border-color);
    }

    td {
      padding: .25em .5em;
      border: 1px solid var(--main-border-color);
    }

    img {
      max-width: 90%;
    }
  </style>
</head>

<body>
  <h1>“A table view that allows navigation and selection using a hardware keyboard.” | Swift Snippet by Douglas Hill</h1>

<pre><code>swift
// Douglas Hill, December 2018
// Made for https://douglashill.co/reading-app/

import UIKit

/// A table view that allows navigation and selection using a hardware keyboard.
/// Only supports a single section.
class KeyboardTableView: UITableView 
    // These properties may be set or overridden to provide discoverability titles for key commands.
    var selectAboveDiscoverabilityTitle: String?
    var selectBelowDiscoverabilityTitle: String?
    var selectTopDiscoverabilityTitle: String?
    var selectBottomDiscoverabilityTitle: String?
    var clearSelectionDiscoverabilityTitle: String?
    var activateSelectionDiscoverabilityTitle: String?

    override var canBecomeFirstResponder: Bool {
        return true
    }

    override var keyCommands: [UIKeyCommand]? {
        var commands = super.keyCommands ?? []

        commands.append(UIKeyCommand(input: UIKeyCommand.inputUpArrow, modifierFlags: [], action: #selector(selectAbove), maybeDiscoverabilityTitle: selectAboveDiscoverabilityTitle))
        commands.append(UIKeyCommand(input: UIKeyCommand.inputDownArrow, modifierFlags: [], action: #selector(selectBelow), maybeDiscoverabilityTitle: selectBelowDiscoverabilityTitle))
        commands.append(UIKeyCommand(input: UIKeyCommand.inputUpArrow, modifierFlags: .command, action: #selector(selectTop), maybeDiscoverabilityTitle: selectTopDiscoverabilityTitle))
        commands.append(UIKeyCommand(input: UIKeyCommand.inputDownArrow, modifierFlags: .command, action: #selector(selectBottom), maybeDiscoverabilityTitle: selectBottomDiscoverabilityTitle))

        commands.append(UIKeyCommand(input: UIKeyCommand.inputEscape, modifierFlags: [], action: #selector(clearSelection), maybeDiscoverabilityTitle: clearSelectionDiscoverabilityTitle))

        commands.append(UIKeyCommand(input: &quot; &quot;, modifierFlags: [], action: #selector(activateSelection)))
        commands.append(UIKeyCommand(input: &quot;\r&quot;, modifierFlags: [], action: #selector(activateSelection), maybeDiscoverabilityTitle: activateSelectionDiscoverabilityTitle))

        return commands
    }

    @objc func selectAbove() {
        if let oldSelectedIndexPath = indexPathForSelectedRow {
            selectRowAtIndex(oldSelectedIndexPath.row - 1)
        } else {
            selectBottom()
        }
    }

    @objc func selectBelow() {
        if let oldSelectedIndexPath = indexPathForSelectedRow {
            selectRowAtIndex(oldSelectedIndexPath.row + 1)
        } else {
            selectTop()
        }
    }

    @objc func selectTop() {
        selectRowAtIndex(0)
    }

    @objc func selectBottom() {
        selectRowAtIndex(numberOfRows(inSection: 0) - 1)
    }

    /// Tries to select and scroll to the row at the given index in section 0.
    /// Does not require the index to be in bounds. Does nothing if out of bounds.
    private func selectRowAtIndex(_ rowIndex: Int) {
        guard rowIndex &gt;= 0 &amp;&amp; rowIndex &lt; numberOfRows(inSection: 0) else {
            return
        }

        let indexPath = IndexPath(row: rowIndex, section: 0)

        switch cellVisibility(atIndexPath: indexPath) {
        case .fullyVisible:
            selectRow(at: indexPath, animated: false, scrollPosition: .none)
        case .notFullyVisible(let scrollPosition):
            // Looks better and feel more responsive if the selection updates without animation.
            selectRow(at: indexPath, animated: false, scrollPosition: .none)
            scrollToRow(at: indexPath, at: scrollPosition, animated: true)
            flashScrollIndicators()
        }
    }

    /// Whether a row is fully visible, or if not if it’s above or below the viewport.
    enum CellVisibility { case fullyVisible; case notFullyVisible(ScrollPosition); }

    /// Whether the given row is fully visible, or if not if it’s above or below the viewport.
    private func cellVisibility(atIndexPath indexPath: IndexPath) -&gt; CellVisibility {
        let rowRect = rectForRow(at: indexPath)
        if bounds.inset(by: adjustedContentInset).contains(rowRect) {
            return .fullyVisible
        }

        let position: ScrollPosition = rowRect.midY &lt; bounds.midY ? .top : .bottom
        return .notFullyVisible(position)
    }

    @objc func clearSelection() {
        selectRow(at: nil, animated: false, scrollPosition: .none)
    }

    @objc func activateSelection() {
        guard let indexPathForSelectedRow = indexPathForSelectedRow else {
            return
        }
        delegate?.tableView?(self, didSelectRowAt: indexPathForSelectedRow)
    }
}

private extension UIKeyCommand {
    convenience init(input: String, modifierFlags: UIKeyModifierFlags, action: Selector, maybeDiscoverabilityTitle: String?) {
        if let discoverabilityTitle = maybeDiscoverabilityTitle {
            self.init(input: input, modifierFlags: modifierFlags, action: action, discoverabilityTitle: discoverabilityTitle)
        } else {
            self.init(input: input, modifierFlags: modifierFlags, action: action)
        }
    }
}
</code></pre>

<pre><code class="a"></code></pre>

</body>

<footer>
<p><a href="https://twitter.com/NeoYokel">Twitter</a> - <a href="https://mastodon.social/@DavidBlue">Mastodon</a> - <a href="https://t.me/davidblue">Telegram</a> - <a href="drafts://open?uuid=DFBC917C-2B4C-4222-B05B-45B49DBA42AA">Local</a></p>
</footer>
</html>